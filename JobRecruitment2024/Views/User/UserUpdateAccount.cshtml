@model JobRecruitment2024.Models.Users
@{
    ViewBag.Title = "User Update Account";
}

<h2>@ViewBag.Title</h2>

<div id="errorMessage" style="display: none; color: red;">Passwords do not match!</div>

@if (ViewBag.SuccessMessage != null)
{
    <p>@ViewBag.SuccessMessage</p>
    <script>
        setTimeout(function () {
            window.location.href = '@Url.Action("UserMainPage", "User")';
        }, 3000); // Redirect after 3 seconds
    </script>
}


@if (ViewBag.ErrorMessage == "User not found. Redirecting Main Page")
{<p>@ViewBag.ErrorMessage</p>
<script>
        setTimeout(function () {
            window.location.href = '@Url.Action("Login", "User")';
        }, 3000); // Redirect after 3 seconds
</script>
}
else
{
<p>@ViewBag.ErrorMessage</p>
}


@using (Html.BeginForm("UserUpdateAccount", "User", FormMethod.Post, new { id = "updateForm" }))
{
    @Html.LabelFor(model => model.name, "Name:")
    @Html.TextBoxFor(model => model.name)
    @Html.Raw("<br><br>")

    @Html.LabelFor(model => model.surname, "Surname:")
    @Html.TextBoxFor(model => model.surname)
    @Html.Raw("<br><br>")

    @Html.LabelFor(model => model.email, "Email:")
    @Html.TextBoxFor(model => model.email, new { type = "email" })
    @Html.Raw("<br><br>")

    @Html.LabelFor(model => model.phone_num, "Phone Number:")
    @Html.TextBoxFor(model => model.phone_num)
    @Html.Raw("<br><br>")

    @Html.CheckBox("changePassword", new { id = "changePasswordCheckbox" })
    @Html.Label("changePassword", "Change Password")
    @Html.Raw("<br><br>")

    <div id="newPasswordField" style="display: none;">
        @Html.LabelFor(model => model.password, "New Password:")
        @Html.PasswordFor(model => model.password, new { id = "newPassword" })
        @Html.Raw("<br><br>")
    </div>

    <div id="newPasswordAgainField" style="display: none;">
        @Html.Label("newPasswordAgain", "New Password Again:")
        @Html.Password("newPasswordAgain", null)
        @Html.Raw("<br><br>")
    </div>

    <button type="submit">Update Account</button>
}


<script>
    document.getElementById('changePasswordCheckbox').addEventListener('change', function () {
        var newPasswordField = document.getElementById('newPasswordField');
        var newPasswordAgainField = document.getElementById('newPasswordAgainField');

        if (this.checked) {
            newPasswordField.style.display = 'block';
            newPasswordAgainField.style.display = 'block';
            // Make password fields required
            document.getElementById('newPassword').setAttribute('required', 'required');
            document.getElementById('newPasswordAgain').setAttribute('required', 'required');
        } else {
            newPasswordField.style.display = 'none';
            newPasswordAgainField.style.display = 'none';
            // Remove required attribute when checkbox is unchecked
            document.getElementById('newPassword').removeAttribute('required');
            document.getElementById('newPasswordAgain').removeAttribute('required');
        }
    });

    document.getElementById('updateForm').addEventListener('submit', function (event) {
        var password = document.getElementById('newPassword');
        var passwordAgain = document.getElementById('newPasswordAgain');
        var errorMessage = document.getElementById('errorMessage');

        var changePasswordCheckbox = document.getElementById('changePasswordCheckbox');
        if (changePasswordCheckbox.checked) {
            if (password.value === '' || passwordAgain.value === '') {
                errorMessage.textContent = 'Please fill in both password fields';
                errorMessage.style.display = 'block';
                password.setAttribute('required', 'required');
                passwordAgain.setAttribute('required', 'required');
                event.preventDefault(); // Prevent form submission
            } else if (password.value !== passwordAgain.value) {
                errorMessage.textContent = 'Passwords do not match';
                errorMessage.style.display = 'block';
                password.removeAttribute('required');
                passwordAgain.removeAttribute('required');
                event.preventDefault(); // Prevent form submission
            } else {
                errorMessage.style.display = 'none';
                password.setAttribute('required', 'required');
                passwordAgain.setAttribute('required', 'required');
            }
        } else {
            errorMessage.style.display = 'none';
            password.removeAttribute('required');
            passwordAgain.removeAttribute('required');
        }
    });

</script>